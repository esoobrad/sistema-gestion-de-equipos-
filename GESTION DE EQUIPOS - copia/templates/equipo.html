<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Detalle del equipo</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static', filename='estilo.css') }}">
</head>
<body class="dark-bg text-light">
<div class="container my-4">
  <div class="d-flex align-items-center mb-3">
    <h2 class="mb-0">üíª Equipo: {{ equipo[1] }}</h2>
    <div class="ms-auto d-flex gap-2">
      <a href="/editar_equipo/{{ equipo[0] }}" class="btn btn-warning">‚úèÔ∏è Editar</a>
      <a href="/equipos" class="btn btn-secondary">‚¨Ö Volver</a>
    </div>
  </div>

  <div class="row g-3">
    <!-- Informaci√≥n general -->
    <div class="col-md-6">
      <div class="p-3 rounded dark-card">
        <h5 class="mb-3">Informaci√≥n general</h5>
        <p class="mb-1"><strong>Nombre:</strong> {{ equipo[1] }}</p>
        <p class="mb-1"><strong>No. factura:</strong> {{ equipo[2] }}</p>
        <p class="mb-1"><strong>Marca / Modelo:</strong> {{ equipo[5] }} / {{ equipo[6] }}</p>
        <p class="mb-1"><strong>Serie:</strong> {{ equipo[7] }}</p>
        <p class="mb-1"><strong>MAC:</strong> {{ equipo[3] }}</p>
        <p class="mb-1"><strong>IP:</strong> {{ equipo[4] }}</p>
        <p class="mb-1"><strong>Fecha compra:</strong> {{ equipo[8] }}</p>
        <p class="mb-1"><strong>Usuario asignado:</strong> {{ equipo[9] }}</p>
        <p class="mb-1"><strong>Usuario dominio:</strong> {{ equipo[10] }}</p>
        <p class="mb-1"><strong>En dominio:</strong> {{ equipo[11] }}</p>
        <p class="mb-1"><strong>Symantec:</strong> {{ equipo[12] }}</p>
        <p class="mb-1"><strong>BitLocker:</strong> {{ equipo[13] }}</p>
        <p class="mb-1"><strong>Internet:</strong> {{ equipo[14] }}</p>
        <p class="mb-1"><strong>Empresa:</strong> {{ equipo[17] if equipo|length > 17 else '' }}</p>

        <div class="mt-3">
          <strong>Archivo:</strong>
          {% if equipo|length > 15 and equipo[15] %}
            <a href="/equipo/{{ equipo[0] }}/archivo" target="_blank" class="btn btn-outline-info btn-sm ms-2">üìé Ver</a>
            <form action="/equipo/{{ equipo[0] }}/eliminar_archivo" method="post" class="d-inline ms-2"
                  onsubmit="return confirm('¬øEliminar el archivo adjunto del equipo?');">
              <button type="submit" class="btn btn-outline-danger btn-sm">üóëÔ∏è Eliminar</button>
            </form>
          {% else %}
            <span class="text-muted ms-2">‚Äî Sin archivo ‚Äî</span>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Componentes -->
    <div class="col-md-6">
      <div class="p-3 rounded dark-card">
        <div class="d-flex align-items-center mb-3">
          <h5 class="mb-0">Componentes / Software</h5>
          <div class="ms-auto d-flex gap-2">
            <a href="/equipo/{{ equipo[0] }}/reporte_componentes" class="btn btn-primary btn-sm">üìÑ PDF</a>
            <a href="/equipo/{{ equipo[0] }}/csv_componentes" class="btn btn-warning btn-sm">üìÅ CSV</a>
          </div>
        </div>

        {% if componentes %}
          <div class="table-responsive">
            <table class="table table-dark table-bordered align-middle text-center">
              <thead>
                <tr>
                  <th>Software</th>
                  <th>Versi√≥n</th>
                  <th>Llave del producto</th>
                  <th>Proveedor</th>
                  <th>Vence</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                {% for c in componentes %}
                {# √≠ndices: 0 id,1 equipo_id,2 software,3 version,4 serie_software,5 id_producto,6 llave,7 proveedor,8 aplica,9 compra,10 vence,11 archivo #}
                {% set vence_raw = (c[10] or '') %}
                {% set vence = 'OEM' if vence_raw|upper == 'OEM' else (vence_raw if vence_raw else '‚Äî') %}
                <tr>
                  <td class="text-start">{{ c[2] }}</td>
                  <td>{{ c[3] }}</td>
                  <td class="text-start">{{ c[6] }}</td>
                  <td class="text-start">{{ c[7] }}</td>
                  <td>{{ vence }}</td>
                  <td class="d-flex justify-content-center gap-2">
                    <a href="/editar_componente/{{ c[0] }}/{{ equipo[0] }}" class="btn btn-outline-warning btn-sm">‚úèÔ∏è</a>
                    <a href="/eliminar_componente/{{ c[0] }}/{{ equipo[0] }}"
                       class="btn btn-outline-danger btn-sm"
                       onclick="return confirm('¬øEliminar este componente?')">üóëÔ∏è</a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="text-muted">Sin componentes registrados.</p>
        {% endif %}

        <a href="/equipo/{{ equipo[0] }}/nuevo" class="btn btn-success mt-2">‚ûï Agregar componente</a>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
